{% extends "layout.html" %}

{% block content %}

<style>
  .monitor-hero {
    background: linear-gradient(135deg, #0f9b0f, #00b4d8);
    color: #fff;
    border-radius: 1rem;
    padding: 1.25rem 1.75rem;
    margin-top: 1rem;
    margin-bottom: 1.75rem;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 1rem;
  }

  .monitor-hero h2 {
    margin: 0;
    font-weight: 600;
  }

  .monitor-hero p {
    margin: 0.25rem 0 0;
    opacity: 0.9;
  }

  .charts-container {
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: 1.5rem;
    margin-top: 1.5rem;
    margin-bottom: 2rem;
  }

  @media (max-width: 992px) {
    .charts-container {
      grid-template-columns: 1fr;
    }
  }

  .chart-box {
    background: #ffffff;
    border-radius: 1rem;
    padding: 1rem 1.25rem 1.5rem;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.06);
    border: 1px solid #e5e7eb;
    min-height: 320px;
    display: flex;
    flex-direction: column;
  }

  .chart-box h4 {
    font-size: 1rem;
    font-weight: 600;
    margin-bottom: 0.75rem;
    color: #1f2933;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .chart-box canvas {
    width: 100% !important;
    height: 260px !important;
    max-height: none;
  }
</style>

<div class="monitor-hero">
  <div>
    <h2>ğŸ’» Sistem CanlÄ± Ä°zleme Paneli</h2>
    <p>CPU / GPU / RAM deÄŸerleri her 1 saniyede bir otomatik gÃ¼ncellenir.</p>
    <p class="mt-2 mb-0">
      Toplam CO2e:
      <strong id="co2TotalValue">0.000000</strong> kg
      &nbsp;&nbsp;|&nbsp;&nbsp;
      GPU CO2e:
      <strong id="co2GpuValue">0.000000</strong> kg
    </p>
  </div>
  <div>
    <button id="resetEnergyBtn" class="btn btn-outline-light btn-sm">
      SayaÃ§larÄ± SÄ±fÄ±rla
    </button>
  </div>
</div>

<div class="charts-container">
  <div class="chart-box">
    <h4>
      <span>CPU KullanÄ±mÄ± (%)</span>
      <span class="badge bg-light text-dark">GerÃ§ek zamanlÄ±</span>
    </h4>
    <canvas id="cpuChart"></canvas>
  </div>

  <div class="chart-box">
    <h4>
      <span>GPU KullanÄ±mÄ± (%)</span>
      <span class="badge bg-light text-dark">GerÃ§ek zamanlÄ±</span>
    </h4>
    <canvas id="gpuChart"></canvas>
  </div>

  <div class="chart-box">
    <h4>
      <span>RAM KullanÄ±mÄ± (MB)</span>
      <span class="badge bg-light text-dark">GerÃ§ek zamanlÄ±</span>
    </h4>
    <canvas id="ramChart"></canvas>
  </div>

  <div class="chart-box">
    <h4>
      <span>GPU GÃ¼Ã§ TÃ¼ketimi (W)</span>
      <span class="badge bg-light text-dark">GerÃ§ek zamanlÄ±</span>
    </h4>
    <canvas id="powerChart"></canvas>
  </div>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- CanlÄ± izleme JS -->
<script src="{{ url_for('static', path='js/monitor_live.js') }}?v=2" defer></script>

<script>
  // SayaÃ§ sÄ±fÄ±rlama butonu
  document.addEventListener("DOMContentLoaded", () => {
    const btn = document.getElementById("resetEnergyBtn");
    if (!btn) return;

    btn.addEventListener("click", async () => {
      const ok = confirm("Enerji ve COâ‚‚ sayaÃ§larÄ±nÄ± sÄ±fÄ±rlamak istediÄŸinize emin misiniz?");
      if (!ok) return;

      try {
        await fetch("/monitor/reset", {
          method: "POST",
          headers: {
            "X-Requested-With": "XMLHttpRequest"
          }
        });
        // En temiz Ã§Ã¶zÃ¼m: sayfayÄ± tazeleyip grafikleri ve sayaÃ§larÄ± sÄ±fÄ±rdan baÅŸlatmak
        window.location.reload();
      } catch (err) {
        console.error(err);
        alert("SayaÃ§lar sÄ±fÄ±rlanÄ±rken bir hata oluÅŸtu.");
      }
    });
  });
</script>

{% endblock %}
